<!DOCTYPE html>
<html lang="uz" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UzSentTokenization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-base-200 to-base-300">
    <div class="max-w-[90rem] mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Hero Section -->
        <div class="hero mb-12">
            <div class="hero-content text-center">
                <div class="scale-in">
                    <h1 class="text-5xl md:text-6xl font-extrabold mb-4 text-primary bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                        UzSentTokenization
                    </h1>
                    <p class="text-xl text-base-content/70 max-w-3xl animate-fade-in">
                        Matnlarni professional darajada tokenlashtirish uchun eng zamonaviy yechim
                    </p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <!-- Input Card -->
            <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-all duration-300 sticky top-8 backdrop-blur-lg bg-opacity-90">
                <div class="card-body">
                    <h2 class="card-title text-3xl gap-3 mb-6 group">
                        <svg class="w-8 h-8 text-primary transition-transform group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Matn kiriting</span>
                    </h2>
                    <form id="tokenForm" class="space-y-8" method="post" action="/">
                        {% csrf_token %}
                        <div class="form-control w-full">
                            <div class="relative">
                                <textarea 
                                    name="text" 
                                    id="text" 
                                    rows="16"
                                    class="textarea textarea-bordered textarea-lg focus:textarea-primary w-full resize-none text-lg transition-all duration-300 hover:shadow-md focus:shadow-lg"
                                    placeholder="Bu yerga matningizni kiriting..."
                                ></textarea>
                                <button 
                                    onclick="clearTextArea()" 
                                    class="btn btn-ghost btn-sm btn-circle absolute top-2 right-2 hover:bg-base-200"
                                    title="Tozalash"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <label class="label">
                                <span class="label-text-alt badge badge-primary badge-outline" id="charCount">0 ta belgi</span>
                            </label>
                        </div>
                        <button 
                            type="submit" 
                            class="btn btn-primary btn-lg w-full gap-3 hover:scale-[1.02] transition-transform duration-300 shadow-lg hover:shadow-xl"
                        >
                            <svg class="w-6 h-6 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Tokenlarni olish
                        </button>
                    </form>
                </div>
            </div>

            <!-- Results Card -->
            <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-all duration-300 backdrop-blur-lg bg-opacity-90">
                <div class="card-body">
                    <div class="sticky top-0 z-10 bg-base-100 pb-4 bg-opacity-90 backdrop-blur">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <h2 class="card-title text-3xl gap-3 group">
                                <svg class="w-8 h-8 text-primary transition-transform group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                </svg>
                                <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Natija</span>
                            </h2>
                            <button 
                                onclick="copyAllTokens()" 
                                class="btn btn-outline btn-primary btn-sm gap-2 hover:scale-105 transition-transform duration-300"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                Hammasini nusxalash
                            </button>
                        </div>
                        <div class="divider before:bg-gradient-to-r before:from-primary/20 before:to-secondary/20 after:bg-gradient-to-l after:from-primary/20 after:to-secondary/20"></div>
                    </div>
                    <div id="result" class="max-h-[calc(100vh-12rem)] overflow-y-auto scrollbar-thin">
                        <div class="flex items-center justify-center h-full">
                            <p class="text-base-content/60 text-lg text-center animate-pulse">Natijalar bu yerda ko'rsatiladi</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Character counter
        document.getElementById('text').addEventListener('input', function(e) {
            document.getElementById('charCount').textContent = `${e.target.value.length} ta belgi`;
        });

        document.getElementById('tokenForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const text = document.getElementById('text').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = showLoading();
            
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: 'text=' + encodeURIComponent(text)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Kelgan data:', data);
                
                let tokens = [];
                if (typeof data.tokens === 'string') {
                    tokens = data.tokens.split(',');
                } else if (Array.isArray(data.tokens)) {
                    tokens = data.tokens;
                }

                // Handle error tokens
                if (data.error_tokens && data.error_tokens.length > 0) {
                    showErrorTokensAlert(data.error_tokens);
                }

                if (tokens.length > 0) {
                    resultDiv.innerHTML = displayTokens(tokens, data.error_tokens || []);
                    animateTokens();
                } else {
                    resultDiv.innerHTML = `
                        <div class="flex items-center justify-center h-full">
                            <p class="text-gray-500 text-lg text-center">Tokenlar topilmadi</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Xato:', error);
                resultDiv.innerHTML = showError(error.message);
            });
        });

        function copyToken(button) {
            const tokenElement = button.parentElement.querySelector('[data-token]');
            const token = tokenElement.getAttribute('data-token');
            
            navigator.clipboard.writeText(token).then(() => {
                // Show copy feedback with enhanced animation
                const originalSvg = button.innerHTML;
                button.innerHTML = `
                    <svg class="w-6 h-6 text-success animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                `;
                
                setTimeout(() => {
                    button.innerHTML = originalSvg;
                }, 1500);
            });
        }

        function copyAllTokens() {
            const tokens = Array.from(document.querySelectorAll('[data-token]'))
                .map(el => el.getAttribute('data-token'))
                .join('\n');
            
            navigator.clipboard.writeText(tokens).then(() => {
                showToast('Barcha tokenlar nusxalandi');
            });
        }

        function animateTokens() {
            const tokens = document.querySelectorAll('.token-item');
            tokens.forEach((token, index) => {
                token.style.animationDelay = `${index * 0.1}s`;
                token.classList.add('scale-in');
            });
        }

        function displayTokens(tokens, errorTokens = []) {
            return `
                <div class="grid gap-4 animate-fade-in">
                    ${tokens.map((token, index) => {
                        const isError = errorTokens.includes(token.trim());
                        return `
                            <div class="token-item card card-compact ${isError ? 'bg-error/10' : 'bg-base-200'} hover:shadow-md transition-all duration-300 hover:scale-[1.02] group">
                                <div class="card-body flex-row items-center gap-4">
                                    <div class="badge ${isError ? 'badge-error' : 'badge-primary'} badge-lg group-hover:scale-110 transition-transform">${index + 1}</div>
                                    <div class="flex-grow font-medium break-all group-hover:text-primary transition-colors" data-token="${token.trim()}">
                                        ${token.trim()} ${isError ? '<span class="text-error">(?)</span>' : ''}
                                    </div>
                                    <button onclick="copyToken(this)" class="btn btn-ghost btn-sm btn-square tooltip tooltip-left hover:bg-primary/10 transition-colors" data-tip="Nusxa olish">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-8m-10 0v-2a2 2 0 012-2h4.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V17a2 2 0 01-2 2h-2M15 2h.01"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function showLoading() {
            return `
                <div class="flex items-center justify-center h-full">
                    <div class="flex flex-col items-center gap-4">
                        <span class="loading loading-spinner loading-lg text-primary"></span>
                        <p class="text-primary font-semibold animate-pulse">Yuklanmoqda...</p>
                    </div>
                </div>
            `;
        }

        function showError(message) {
            return `
                <div class="flex items-center justify-center h-full">
                    <div class="alert alert-error shadow-lg animate-shake">
                        <svg class="w-6 h-6 stroke-current shrink-0" fill="none" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Xatolik yuz berdi: ${message}</span>
                    </div>
                </div>
            `;
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast toast-end';
            toast.innerHTML = `
                <div class="alert alert-success shadow-lg animate-slide-up">
                    <svg class="w-5 h-5 stroke-current shrink-0" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // Add new function to display error tokens with SweetAlert2
        function showErrorTokensAlert(errorTokens) {
            const errorTokensList = errorTokens.map(token => `<li class="text-left">❌ "${token}" - to'g'ri yozilmagan so'z</li>`).join('');
            
            Swal.fire({
                title: '<strong>Xatoliklar aniqlandi</strong>',
                icon: 'warning',
                html: `
                    <div class="text-left">
                        <p class="mb-3">Quyidagi so'zlar to'g'ri yozilmagan:</p>
                        <ul class="space-y-2">
                            ${errorTokensList}
                        </ul>
                        <p class="mt-3 text-sm text-gray-600">Iltimos, so'zlarni tekshirib, to'g'rilab qayta kiriting.</p>
                    </div>
                `,
                showCloseButton: true,
                showConfirmButton: true,
                confirmButtonText: 'Tushundim',
                confirmButtonColor: '#3085d6',
                customClass: {
                    container: 'sweet-alert-custom',
                    popup: 'rounded-lg',
                    title: 'text-xl font-bold text-warning',
                    htmlContainer: 'py-4'
                }
            });
        }

        // Tozalash funksiyasini qo'shamiz
        function clearTextArea() {
            document.getElementById('text').value = '';
            document.getElementById('charCount').textContent = '0 ta belgi';
        }
    </script>

    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.4s ease-out forwards;
        }

        @keyframes scale-in {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .scale-in {
            animation: scale-in 0.3s ease-out forwards;
        }

        .token-item {
            opacity: 0;
            transform: translateY(20px);
            animation: slideUp 0.5s ease forwards;
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .animate-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }

        .hover-scale {
            transition: transform 0.2s ease;
        }

        .hover-scale:hover {
            transform: scale(1.02);
        }

        .loading-pulse {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }

        .token-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        @media (max-width: 1024px) {
            .token-container {
                grid-template-columns: 1fr;
            }
        }

        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Smooth transitions */
        * {
            transition: all 0.2s ease-in-out;
        }
    </style>
</body>
</html>